<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üìä Analizador HCN (C√≥digos G/M)</title>
  <style>
    body { background: #121212; color: #f0f0f0; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
    h1 { color: #bb86fc; text-align: center; }
    textarea, pre, svg, button { width: 100%; box-sizing: border-box; }
    textarea { height: 150px; background: #1e1e1e; color: #f0f0f0; border: none; border-radius: 10px; padding: 10px; font-family: monospace; }
    pre { background: #1e1e1e; padding: 10px; border-radius: 10px; margin-top: 10px; white-space: pre-wrap; word-wrap: break-word; }
    svg { height: 300px; background: #000; margin-top: 10px; border: 1px solid #444; }
    .ok { color: #a0f8a0; } .error { color: #ff5252; }
    .controls { display: flex; gap: 10px; margin: 10px 0; flex-wrap: wrap; }
    button { background: #bb86fc; color: #000; padding: 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    button:hover { background: #d1afff; }
    .table-container { margin-top: 40px; background: #1e1e1e; padding: 20px; border-radius: 12px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px 10px; border-bottom: 1px solid #444; }
    th { color: #bb86fc; text-align: left; }
  </style>
</head>
<body>
<h1>üìä Analizador de C√≥digo G/M para HCN</h1>

<textarea id="codigo" placeholder="Pega aqu√≠ tu programa CNC..."></textarea>
<div class="controls">
  <button onclick="analizar()">üîç Analizar</button>
  <button onclick="copiar()">üìã Copiar</button>
  <button onclick="simular()">‚ñ∂Ô∏è Simular</button>
  <button onclick="paso()">‚è≠Ô∏è Paso</button>
  <button onclick="reiniciar()">üîÅ Reiniciar</button>
</div>
<pre id="resultado"></pre>
<svg id="simulador" viewBox="0 0 500 300"></svg>

<div class="table-container">
  <h2>üìò Tabla de C√≥digos G y M en HCN</h2>
  <table>
    <tr><th>C√≥digo</th><th>Descripci√≥n</th></tr>
    <tr><td>G00</td><td>Movimiento r√°pido</td></tr>
    <tr><td>G01</td><td>Interpolaci√≥n lineal</td></tr>
    <tr><td>G02</td><td>Interpolaci√≥n circular CW</td></tr>
    <tr><td>G03</td><td>Interpolaci√≥n circular CCW</td></tr>
    <tr><td>G20</td><td>Unidades en pulgadas</td></tr>
    <tr><td>G21</td><td>Unidades en mil√≠metros</td></tr>
    <tr><td>G28</td><td>Retorno a posici√≥n de referencia</td></tr>
    <tr><td>G70</td><td>Acabado (repetici√≥n del perfil)</td></tr>
    <tr><td>G71</td><td>Desbaste longitudinal</td></tr>
    <tr><td>G72</td><td>Desbaste transversal</td></tr>
    <tr><td>G73</td><td>Desbaste de alta eficiencia</td></tr>
    <tr><td>G74</td><td>Ranurado frontal</td></tr>
    <tr><td>G75</td><td>Ranurado radial</td></tr>
    <tr><td>G76</td><td>Ciclo de roscado multipasada</td></tr>
    <tr><td>G80‚ÄìG89</td><td>Ciclos de taladrado, mandrinado, roscado r√≠gido</td></tr>
    <tr><td>M00</td><td>Pausa programada</td></tr>
    <tr><td>M03</td><td>Husillo sentido horario (CW)</td></tr>
    <tr><td>M04</td><td>Husillo antihorario (CCW)</td></tr>
    <tr><td>M05</td><td>Parar husillo</td></tr>
    <tr><td>M08</td><td>Activar refrigerante</td></tr>
    <tr><td>M09</td><td>Desactivar refrigerante</td></tr>
    <tr><td>M30</td><td>Fin de programa y reinicio</td></tr>
  </table>
</div>

<script>
let lineas = [], index = 0, x = 250, z = 150, svg;

function analizar() {
  let input = document.getElementById("codigo").value.trim().split("\\n");
  lineas = input.filter(l => l.trim()); index = 0; x = 250; z = 150;
  let salida = '', ok = 0, err = 0;
  for (let i = 0; i < lineas.length; i++) {
    let l = lineas[i].toUpperCase().trim();
    let exp = '';
    if (!l) { exp = '‚ùå L√≠nea vac√≠a'; err++; }
    else if (l.includes("G70")) exp = "Acabado con perfil";
    else if (l.includes("G71")) exp = "Desbaste longitudinal";
    else if (l.includes("G72")) exp = "Desbaste transversal";
    else if (l.includes("G73")) exp = "Desbaste alta eficiencia";
    else if (l.includes("G74")) exp = "Ranurado frontal";
    else if (l.includes("G75")) exp = "Ranurado radial";
    else if (l.includes("G76")) exp = "Roscar multipasadas";
    else if (l.match(/G8[0-9]/)) exp = "Ciclo de taladrado o roscado";
    else if (l.includes("G00")) exp = "Movimiento r√°pido";
    else if (l.includes("G01")) exp = "Movimiento lineal";
    else if (l.includes("M03")) exp = "Husillo CW";
    else if (l.includes("M05")) exp = "Parar husillo";
    else if (l.includes("M08")) exp = "Refrigerante ON";
    else if (l.includes("M09")) exp = "Refrigerante OFF";
    else if (l.includes("M30")) exp = "Fin de programa";
    else if (l.match(/X|Z/)) exp = "Movimiento en eje";
    else exp = '‚ùå C√≥digo no reconocido', err++;
    if (!exp.startsWith('‚ùå')) ok++;
    salida += `<span class="${exp.startsWith('‚ùå') ? 'error':'ok'}">L√≠nea ${i+1}: ${l} ‚Üí ${exp}</span>\\n`;
  }
  document.getElementById("resultado").innerHTML = salida + "\\nüìÑ Total: " + lineas.length + " | ‚úÖ V√°lidas: " + ok + " | ‚ùå Errores: " + err;
  reiniciar();
}

function copiar() {
  navigator.clipboard.writeText(document.getElementById("resultado").innerText).then(() => alert("Copiado al portapapeles"));
}

function simular() {
  if (index >= lineas.length) return;
  ejecutar(lineas[index]); index++; setTimeout(simular, 500);
}

function paso() {
  if (index < lineas.length) ejecutar(lineas[index++]);
}

function reiniciar() {
  svg = document.getElementById("simulador"); svg.innerHTML = ""; x = 250; z = 150; index = 0;
  let punto = document.createElementNS("http://www.w3.org/2000/svg", "circle");
  punto.setAttribute("cx", x); punto.setAttribute("cy", z); punto.setAttribute("r", 4); punto.setAttribute("fill", "#0f0");
  svg.appendChild(punto);
}

function ejecutar(l) {
  l = l.toUpperCase();
  if (!(l.includes("G00") || l.includes("G01"))) return;
  let X = l.match(/X(-?\\d+\\.?\\d*)/); let Z = l.match(/Z(-?\\d+\\.?\\d*)/);
  let newX = X ? 250 + parseFloat(X[1]) : x;
  let newZ = Z ? 150 - parseFloat(Z[1]) : z;
  let linea = document.createElementNS("http://www.w3.org/2000/svg", "line");
  linea.setAttribute("x1", x); linea.setAttribute("y1", z);
  linea.setAttribute("x2", newX); linea.setAttribute("y2", newZ);
  linea.setAttribute("stroke", "#bb86fc"); linea.setAttribute("stroke-width", "2");
  svg.appendChild(linea); x = newX; z = newZ;
}
</script>
</body>
</html>
